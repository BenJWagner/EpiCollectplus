{{style}}
	<style type="text/css">
		img.desc
		{
			display : none;
			float : right;
			margin-top: 0.25em;
		}
		
		.desc img.desc
		{
			display : inline-block;
		}
		
		img.asc
		{
			display : none;
			float : right;
			margin-top: 0.25em;
		}
		
		.asc img.asc
		{
			display : inline-block;
		}
	
		.cp-item {
			vertical-align: top;
			display: inline-block;
			margin-left : 10px;
		}
		
		.cp-item img {
			margin: 0;
		}
		
		.entry
		{
			border-bottom : 1px solid #CCCCCC;
			background-color : #EEEEEE;
			margin : 0;
			padding : 5px 5px 5px 5px;
			
		}
		
		.nolocation
		{
			font-style : italic; 
		}
		
		#timeText
		{
			width : 30em;
		}
		
		.button
		{
			padding : 0.25em 0.5em 0.25em 0.5em;
			margin : 0em 0.25em 0em 0.25em;
			background-color:#C7DFFC;
			border-radius: 0.25em;
			cursor: pointer;
			font-weight : bold;	
			width : 30%;
		}
		
		#mapTab
		{
			position : relative;
		}
		
		#map
		{
			position : relative;
			margin-left : 10em;
			height : 30em;
			right : 0px;
		}
		
		#sidebar 
		{
			position : absolute;
			left : 0;
			top : 1em;
			height : 30em;
			width : 10em;
			border: 1px solid #CCCCCC;
		}
		
		.button:active
		{
			background-color: #CCCCCC;
		}
		
	</style>
{{/style}}

{{script}}
	{#mapScript#}
	<!-- <script type="text/javascript" src="{#formName#}.js"></script>-->
	<script type="text/javascript" src="{#SITE_ROOT#}/js/jquery-ui-1.8.17.custom.min.js"></script>

	<script type="text/javascript">
			var formName = "";
			var map = null;
			
			var qry = location.search.trim("?");
			var sortCol = "created";
			var sortDir = "asc";
			var pageNo = 0;
			var numEnts = 10;
			
			$(function()
			{
				url = location.href.trim("/");
				if(url.indexOf("?") > 0)url = url.substr(0, url.indexOf("?"));
				formName = url.substr(url.lastIndexOf("/") + 1).replace(/#.*$/, "");
				url = url.substr(0, url.lastIndexOf("/"));
				
				
				EpiCollect.loadProject(url + ".xml", loadCallback);
				
				$.fn.disableSelection = function() {
				    return this.each(function() {           
				        $(this).attr('unselectable', 'on')
				               .css({
				                   '-moz-user-select':'none',
				                   '-webkit-user-select':'none',
				                   'user-select':'none',
				                   '-ms-user-select':'none'
				               })
				               .each(function() {
				                   this.onselectstart = function() { return false; };
				               });
				    });
				};
				
			});
	
			
			function createMap(div)
			{
				map = new google.maps.Map(document.getElementById(div), {
					center : new google.maps.LatLng(0,0),
					mapTypeId: google.maps.MapTypeId.HYBRID,
					zoom : 2,
					panControl: true,
					rotateControl: true,
					zoomControl: true
				});
			}
			
			function loadCallback(prj){
				project = prj;		
				
				hasMap = (project.forms[formName].gpsFlds.length > 0);
				
				$("#tabs").tabs({
					show : function(event, tab)
					{
						if(tab.panel.id == "mapTab")
						{
							 cen = map.getCenter();
							 google.maps.event.trigger(map, 'resize');
							 map.setCenter(cen);
						}
					}
				});
				
				if(hasMap)
				{
					createMap("map");			
				}
				else
				{
					$("#tabs li")[1].style.display = "none"; 
				}
				
				
				$("#tableTab .toolbar").after("<table class=\"data\"><thead><tr></tr></thead><tbody></tbody></table>");
				
				for(f in project.forms[formName].fields)
				{
					fld = project.forms[formName].fields[f];
					$(".data tr").append("<th class=\"" + f + "\">" + fld.text + "</th>");	
					$(".data th").resizable({
						handles : "e",
						resize	: function(event, ele)
						{
							window.e = event;
							window.ele = ele;
						
			
							
							$("td." + ele.element[0].className.substring(0, ele.element[0].className.indexOf(" "))).css({ "max-width" : (ele.element.width()-5) + "px"});
						}
					});

				}
				
				$(".data th").append("<img src=\"../../images/uparrow.png\" class=\"asc\" width=\"12\" /><img src=\"../../images/downarrow.png\" class=\"desc\" width=\"12\" />")
					$(".data th").click(function(evt){
						
							var newSortCol = evt.target.classList[0];
							
							
							$(".data th").removeClass("desc");
							$(".data th").removeClass("asc");
				
							console.debug(sortCol + " " + sortDir);
							window.evt = evt;
							if(newSortCol == sortCol && sortDir == "asc")
							{
								$(evt.target).addClass("desc");
								sortDir = "desc";
							}
							else
							{
								$(evt.target).addClass("asc");
								sortDir = "asc";
							}
							sortCol = newSortCol;
							getData();
							evt.preventDefault();
						
					});
				getData();
			};	
			
			
			function getData()
			{
				offset = pageNo * numEnts
				$.getJSON(url + "/" + formName + ".json?mode=list&offset=" + offset + "&limit=" + numEnts + "&sort=" + sortCol + "&dir=" +sortDir + "&" + location.search.substr(1) , dataLoad);
				$('#start').text(offset);
			}
			
			
			function dataLoad(entries)
			{
				$(".data tbody").empty();
				
				$('#end').text(Number($('#start').text()) + Number(entries[formName].length));
				$('#total').text(entries.count);
				
				for(var i = 0; i < entries[formName].length; i++)
				{
					html = "<tr>";
					for(f in project.forms[formName].fields)
					{	
						fld = project.forms[formName].fields[f];
						html += "<td class=\"" + f  + (i % 2 == 1 ? " alt": "") + "\">";
						if(fld.type == "location" || fld.type == "gps")
						{
							if(entries[formName][i][f] == undefined)
							{
								html += "&nbsp;";
							}
							else
							{
								val = JSON.parse(entries[formName][i][f]);
								html +=  val.latitude + "," + val.longitude;
							}
						
						}
						else
						{
							html += entries[formName][i][f] == undefined ? "&nbsp;" : entries[formName][i][f];
						}
						html += "</td>"					
					}
					html += "</tr>";
					$(".data tbody").append(html);
				}
				
				for(f in project.forms[formName].fields)
				{
					$('.' + f).css({"max-width" : $('th.' + f).width() + "px"});
				}
			}
		
	</script>
	
{{/script}}
{{breadcrumbs}}
&gt; <a href="../{#projectName#}">Project : {#projectName#}</a> {#prevForm#} &gt; Form : {#formName#}
{{/breadcrumbs}}
{{main}}
	<h1>{#projectName#} - {#formName#}</h1>
	<div id="tabs">
		<ul>
			<li><a href="#tableTab">Table View</a>
			<li><a href="#mapTab">Map</a>
		</ul>
		<div id="tableTab">
			<p class="toolbar"><a href=""><img src="{#SITE_ROOT#}/images/glyphicons/glyphicons_200_download.png" title="Dowload Data" alt="Download"></a></p>
			
			<p>Showing <span id="start"></span> to <span id="end"></span> of <span id="total"></span></p>	
		</div>
		<div id="mapTab">
			<div id="sidebar"></div>
			<div id="map"></div>
		</div>
		
	</div>
{{/main}}